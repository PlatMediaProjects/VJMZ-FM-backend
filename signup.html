<form id="signupForm" onsubmit="return handleSignup(event)">
  <!-- Honeypot (spam trap) -->
  <input type="text" name="company" style="display:none" tabindex="-1" autocomplete="off" />

  <input type="text"  name="firstName" placeholder="First name" />
  <input type="text"  name="lastName"  placeholder="Last name" />
  <input type="email" name="email"     placeholder="Email" required />
  <input type="text"  name="phone"     placeholder="Phone (optional)" />

  <button type="submit" id="signupBtn">Sign Up</button>
  <div id="status" style="margin-top:.75rem;"></div>
</form>

<script>
async function handleSignup(e){
  e.preventDefault();

  const form = document.getElementById('signupForm');
  const btn  = document.getElementById('signupBtn');
  const msg  = document.getElementById('status');

  // Belt-and-suspenders: ensure the form never navigates
  form.setAttribute('action', 'javascript:void(0)');
  form.setAttribute('method', 'get');

  // Honeypot
  if (form.company && form.company.value.trim() !== '') {
    msg.textContent = 'Blocked as spam.';
    return false;
  }

  const first = (form.firstName?.value || '').trim();
  const last  = (form.lastName ?.value || '').trim();
  const email = (form.email    ?.value || '').trim();
  const phone = (form.phone    ?.value || '').trim();

  if (!email) {
    msg.textContent = 'Please enter a valid email.';
    return false;
  }

  const payload = {
    name: (first || last) ? `${first} ${last}`.trim() : email,
    email,
    phone,
    message: 'Signup form submission (signup.html)'
  };

  // UX
  const saved = btn.textContent;
  btn.disabled = true;
  btn.textContent = 'Sending…';
  msg.textContent = '';

  try {
    const res = await fetch('https://api.vjmz-fm.com/api/contact', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      keepalive: true
    });

    const text = await res.text();
    let data = {}; try { data = JSON.parse(text); } catch {}

    if (!res.ok || data.ok !== true) {
      throw new Error(data.error || `HTTP ${res.status}: ${text}`);
    }

    msg.textContent = '✅ Thanks! Your signup was received.';
    form.reset();
  } catch (err) {
    console.error('[signup submit]', err);
    msg.textContent = '❌ Sorry—something went wrong. Please try again.';
  } finally {
    btn.disabled = false;
    btn.textContent = saved;
  }

  return false; // never navigate
}
</script>
