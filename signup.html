<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign Up</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    form { max-width: 520px; display: grid; gap: .75rem; }
    label { font-weight: 600; }
    input, textarea, button { font: inherit; padding: .65rem .8rem; }
    button { cursor: pointer; }
    button[disabled] { opacity: .7; cursor: not-allowed; }
    .help { color: #666; font-size: .9rem; }
    #signupStatus { margin-top: .5rem; min-height: 1.25rem; }
  </style>
</head>
<body>

  <h1>Sign Up</h1>
  <p class="help">Fill in your details and we’ll be in touch shortly.</p>

  <!-- ✨ The Form -->
  <form id="signupForm" onsubmit="return handleSignup(event)" novalidate>
    <!-- Honeypot (spam trap) -->
    <input type="text" name="company" style="display:none" tabindex="-1" autocomplete="off" />

    <label for="firstName">First name</label>
    <input id="firstName" name="firstName" autocomplete="given-name" />

    <label for="lastName">Last name</label>
    <input id="lastName" name="lastName" autocomplete="family-name" />

    <label for="email">Email <span aria-hidden="true">*</span></label>
    <input id="email" name="email" type="email" required autocomplete="email" />

    <label for="phone">Phone (optional)</label>
    <input id="phone" name="phone" autocomplete="tel" />

    <button type="submit" id="signupBtn">Sign Up</button>
    <div id="signupStatus" aria-live="polite"></div>
  </form>

  <script>
  async function handleSignup(e){
    e.preventDefault(); // stop native navigation

    const form = document.getElementById('signupForm');
    const btn  = document.getElementById('signupBtn');
    const msg  = document.getElementById('signupStatus');

    // Belt & suspenders: ensure the form never navigates
    form.setAttribute('action', 'javascript:void(0)');
    form.setAttribute('method', 'get');

    // Honeypot
    if (form.company && form.company.value.trim() !== '') {
      msg.textContent = 'Blocked as spam.'; 
      return false;
    }

    const first = (form.firstName?.value || '').trim();
    const last  = (form.lastName ?.value || '').trim();
    const email = (form.email    ?.value || '').trim();
    const phone = (form.phone    ?.value || '').trim();

    if (!email) {
      msg.textContent = 'Please enter a valid email.';
      return false;
    }

    const payload = {
      name: (first || last) ? `${first} ${last}`.trim() : email,
      email,
      phone,
      message: 'Signup form submission (signup.html)'
    };

    // UX: show progress & prevent double clicks
    const saved = btn.textContent;
    btn.disabled = true;
    btn.textContent = 'Sending…';
    msg.textContent = '';

    try {
      const r = await fetch('https://api.vjmz-fm.com/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
        keepalive: true
      });

      const t = await r.text();
      let j = {};
      try { j = JSON.parse(t); } catch {}

      if (!r.ok || j.ok !== true) {
        throw new Error(j.error || `HTTP ${r.status}: ${t}`);
      }

      // ✅ success → redirect to Thank You page
      window.location.assign('/thank-you.html');

      // If you prefer to stay on the page instead, comment the line above
      // and use the two lines below:
      // msg.textContent = '✅ Thanks! Your signup was received.';
      // form.reset();

    } catch (err) {
      console.error('[signup submit]', err);
      msg.textContent = '❌ Sorry—something went wrong. Please try again.';
    } finally {
      btn.disabled = false;
      btn.textContent = saved;
    }

    return false; // never navigate via form
  }
  </script>
</body>
</html>
