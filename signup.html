<form id="signupForm" novalidate>
  <!-- Honeypot -->
  <input type="text" name="company" style="display:none" tabindex="-1" autocomplete="off" />

  <input type="text" name="firstName" placeholder="First name" />
  <input type="text" name="lastName"  placeholder="Last name" />
  <input type="email" name="email"     placeholder="Email" required />
  <input type="text"  name="phone"     placeholder="Phone (optional)" />

  <button type="submit">Sign Up</button>
</form>

<div id="signupStatus" style="margin-top:.75rem;"></div>

<script>
(() => {
  const form = document.getElementById('signupForm');
  const statusEl = document.getElementById('signupStatus');

  // Safety: if the form had an action, neutralize it so the page doesn't navigate.
  if (form.hasAttribute('action')) form.setAttribute('action', 'javascript:void(0)');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    try {
      statusEl.textContent = 'Sending…';

      // Honeypot (spam)
      if (form.company && form.company.value.trim() !== '') {
        statusEl.textContent = 'Blocked as spam.';
        return;
      }

      const first = (form.firstName?.value || '').trim();
      const last  = (form.lastName?.value  || '').trim();
      const email = (form.email?.value     || '').trim();
      const phone = (form.phone?.value     || '').trim();

      if (!email) {
        statusEl.textContent = 'Please enter a valid email.';
        return;
      }

      const payload = {
        name: (first || last) ? `${first} ${last}`.trim() : email,
        email,
        phone,
        message: 'Newsletter / Fan signup from signup.html'
      };

      const res = await fetch('https://api.vjmz-fm.com/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
        // keepalive avoids navigation-related aborts on some browsers
        keepalive: true
      });

      const text = await res.text(); // read first to capture backend error text if any
      let data = {};
      try { data = JSON.parse(text); } catch {}

      if (!res.ok) {
        console.error('Signup POST failed', res.status, text);
        statusEl.textContent = `Error (${res.status}). Please try again.`;
        return;
      }

      statusEl.textContent = '✅ Thank you! Your signup was received.';
      form.reset();
    } catch (err) {
      console.error('Signup JS error', err);
      statusEl.textContent = '❌ Something went wrong. Please try again.';
    }
  });
})();
</script>
